<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign In:TodoList</title>
    <script src="js/jquery.js" type="text/javascript"></script>
    <script src="pace/pace.js"></script>
    <link rel="stylesheet" href="pace/pace.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
    <style>
        .formrow:nth-child(3){
            border-bottom: none;
        }
    </style>
</head>
<body>
<div id="logo"></div>
<div class="errors">
    <div role="alert" class="message">
        The email or password you entered was incorrect. Please try again.
    </div>
</div>
<div id="formWrapper">
    <form>
        <div class="formrow">
            <i class="fa fa-envelope-o" aria-hidden="true" style="color: #328ad6;"></i>
            <input id="email" type="email" name="email" required autofocus
                   pattern="^[^\s@＠=]+[@|＠][^\.\s@＠]+(\.[^\.\s@＠]+)+$"
                   title="Please enter a valid email address." placeholder="Email"/>
        </div>

        <div class="formrow">
            <i class="fa fa-key" aria-hidden="true" style="color: #328ad6;"></i>
            <input id="password" type="password" name="password" required
                   placeholder="Password"/>
        </div>

        <div class="formrow">
            <button id="login" type="submit">Sign In</button>
        </div>

        <div id="forgotPassword">
            <a href="/forgotpassword">
                Forgot your password?
            </a>
        </div>
    </form>
    <div class="separator">
        <h2>OR</h2>
    </div>

    <button type="button" id="googleLogin" class="google">
        <i class="fa fa-google-plus-square" aria-hidden="true"></i>
        <div>Log In With Google Account</div>
    </button>

    <div id="createAccount" class="loginSignupNavigation">
        Don't have an account?
        <a href="/signup">Create Account</a>
    </div>

</div>


<script>
    $(document).ready(function () {
        var cookieVal = document.cookie;
        if(cookieVal != '')
        {
            var cookieArr = cookieVal.split('=');
            $.post('/login/checkclient', {clientId: cookieArr[1]}, function (data, status) {
                if(data.status == 'exists')
                    window.location.href = '/todos';
            });
        }

        $('form').submit(function () {
            var clientData = {
                email: $('#email').val(),
                password: $('#password').val()
            };
            $.post('/login', clientData, function (data, status) {
                if(data.status == 'invalid')
                    $('.errors').css('display', 'table');
                else{
                    var d = new Date();
                    d.setTime(d.getTime() + (365*24*60*60*1000));
                    var expires = "expires="+ d.toUTCString();
                    document.cookie = "todolistClient=" + data.clientId + "; " + expires;
                    window.location.href = '/todos';
                }
            });
            return false;
        });
    })
</script>
</body>
</html>